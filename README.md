# CounselorAI

![CounselorAI Logo](https://placehold.co/600x200/D1C4E9/4A148C?text=CounselorAI&font=ptsans)

The app is deployed at https://councillor-ai.vercel.app/

CounselorAI is a web application built with Next.js and Firebase Genkit that provides a structured, AI-powered space for couples to discuss relationship issues. The application guides users through a multi-step conversation, from defining the problem to receiving a concrete action plan, all facilitated by a generative AI acting as a marriage counselor.

## Screenshots

| Step 1: Enter Names | Step 2: Answer Questions |
| :---: | :---: |
| ![Enter Names](https://placehold.co/400x300/F5F5F5/333333?text=Name+Input+Screen) | ![Answer Questions](https://placehold.co/400x300/F5F5F5/333333?text=Question+Screen) |

| Step 3: Interactive Chat | Step 4: Action Plan |
| :---: | :---: |
| ![Interactive Chat](https://placehold.co/400x300/F5F5F5/333333?text=Chat+Interface) | ![Action Plan](https://placehold.co/400x300/F5F5F5/333333?text=Action+Plan+View) |


## Tech Stack

-   **Framework**: [Next.js](https://nextjs.org/) (with App Router)
-   **AI Integration**: [Firebase Genkit](https://firebase.google.com/docs/genkit)
-   **Language**: [TypeScript](https://www.typescriptlang.org/)
-   **UI Components**: [ShadCN UI](https://ui.shadcn.com/)
-   **Styling**: [Tailwind CSS](https://tailwindcss.com/)
-   **PDF Generation**: [jsPDF](https://github.com/parallax/jsPDF) & [html2canvas](https://html2canvas.hertzen.com/)

## Core Features

-   **Personalized Session**: Users can enter their names for a personalized experience.
-   **Guided Question Flow**: A multi-step process that asks one question at a time to keep users focused.
-   **Dynamic AI Questions**: The AI generates relevant follow-up questions based on the users' initial problem description.
-   **Interactive Chat**: After the initial Q&A, users can have a real-time conversation with the AI counselor.
-   **Actionable Advice**: The session concludes with a clear, bulleted action plan generated by the AI.
-   **Downloadable History**: Users can download a complete transcript of their session as a PDF.
-   **Responsive Design**: The interface is mobile-friendly for access on any device.

## Application Flow

The entire user experience is managed within a single, state-driven React component: `src/app/chat-client.tsx`. This component uses a state machine (`appState`) to transition the UI through various stages of the counseling session.

### 1. State Management (`appState`)

The `appState` variable controls the application's view, progressing through the following stages:

1.  `'names'`: The initial screen where users provide their names.
2.  `'questions'`: The guided Q&A phase where users answer a series of questions one by one.
3.  `'advice'`: The main interactive chat interface where users converse with the AI.
4.  `'ended'`: The final screen displaying the AI-generated action plan and the option to download a PDF.

### 2. The Conversation Journey

Hereâ€™s a step-by-step breakdown of how a user interacts with the application and how the system responds.

#### Step 1: Entering Names (`appState: 'names'`)

-   **User Action**: Users land on the initial screen and enter their names.
-   **System Action**: Clicking **"Begin Session"** calls the `handleStartQuestions` function. It validates that names have been entered and then transitions the `appState` to `'questions'`.

#### Step 2: Answering Questions (`appState: 'questions'`)

-   **User Action**: Users are presented with one question at a time, with separate text areas for each partner to answer. A progress bar at the top indicates their progress.
-   **System Action**:
    1.  The first two questions are static and predefined:
        -   "What is the problem, according to you?"
        -   "Please provide a specific, recent example of when this problem occurred."
    2.  Once both partners answer, they click **"Next"**. The `handleNextQuestion` function is called.
    3.  After the first two questions, `handleNextQuestion` calls `getFollowUpQuestions` (a server action in `src/app/actions.ts`), which in turn triggers a Genkit flow (`src/ai/flows/generate-follow-up-questions.ts`).
    4.  This flow sends the initial problem statements to the Gemini model to generate 3-5 dynamic, relevant follow-up questions.
    5.  The app displays these new questions to the users, one at a time.

#### Step 3: Getting Initial Advice (`appState: 'advice'`)

-   **User Action**: After the final question is answered, the button changes to "Get Counselor's Advice." Clicking it calls `handleGetAdvice`.
-   **System Action**:
    1.  The `handleGetAdvice` function compiles all the questions and answers into a formatted `chatHistory` string.
    2.  It calls the `getAIAdvice` server action, which triggers the primary Genkit flow (`src/ai/flows/generate-counselor-advice.ts`).
    3.  The flow provides the `chatHistory` to the AI, which generates its initial counseling advice.
    4.  The `appState` transitions to `'advice'`, and the UI updates to a conversational chat view, displaying the AI's response.

#### Step 4: Interactive Chat (`appState: 'advice'`)

-   **User Action**: Users can now have a real-time text conversation with the AI. They select their name, type a message, and press send.
-   **System Action**: Sending a message calls `handleSendMessage`. This function appends the new message to the history and immediately calls `getAIAdvice` again with the *complete, updated history*. This ensures the AI's responses are always in context.

#### Step 5: Ending the Session (`appState: 'ended'`)

-   **User Action**: When ready, users click the **"End Session"** button.
-   **System Action**:
    1.  This action calls `handleGetActionableSteps`, triggering the `generateActionableSteps` Genkit flow.
    2.  The AI receives the entire conversation history and is prompted to generate a clear, step-by-step, bulleted action plan.
    3.  The plan is displayed, the chat input is removed, and the `appState` changes to `'ended'`.
    4.  A **"Download PDF"** button appears.

#### Step 6: Downloading the PDF

-   **User Action**: The user clicks the **"Download PDF"** button.
-   **System Action**: The `handleDownloadPdf` function uses the `html2canvas` library to take a "screenshot" of the chat container and `jspdf` to convert that image into a downloadable PDF file named `CounselorAI-Chat-History.pdf`.
